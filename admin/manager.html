<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>青脉果酒管理后台</title>
  <link rel="stylesheet" href="src/css/layui.css">
  <script src="js/jquery-2.0.0.min.js"></script>
  <script src="src/layui.js"></script>
</head>
<style>
    .layui-form-select{
        display: none;
    }
    #username{
        display: block;
    }
</style>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
  <div class="layui-header">
    <div class="layui-logo">青脉果酒管理后台</div>
    <!-- 头部区域（可配合layui已有的水平导航） -->
    <!--<ul class="layui-nav layui-layout-left">
      <li class="layui-nav-item"><a href="">控制台</a></li>
      <li class="layui-nav-item"><a href="">商品管理</a></li>
      <li class="layui-nav-item"><a href="">用户</a></li>
      <li class="layui-nav-item">
        <a href="javascript:;">其它系统</a>
        <dl class="layui-nav-child">
          <dd><a href="">邮件管理</a></dd>
          <dd><a href="">消息管理</a></dd>
          <dd><a href="">授权管理</a></dd>
        </dl>
      </li>
    </ul>-->
    <ul class="layui-nav layui-layout-right">
      <li class="layui-nav-item">
        <a href="javascript:;">
          <img src="http://t.cn/RCzsdCq" class="layui-nav-img">
          管理员
        </a>
        <dl class="layui-nav-child">
          <dd><a id="pass_cs">重设密码</a></dd>

          <!-- <dd><a href="">安全设置</a></dd> -->
        </dl>
      </li>
      <li class="layui-nav-item"><a href="javascript:;" id="logout">退了</a></li>
    </ul>
  </div>
 <!--框架头部--> 
  
  <div class="layui-side layui-bg-black">
    <div class="layui-side-scroll">
      <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
      <ul class="layui-nav layui-nav-tree"  lay-filter="test">
        <li class="layui-nav-item"><a class="" href="goods.html">商品管理</a></li>
        <li class="layui-nav-item"><a href="member.html">用户管理</a></li>
        <li class="layui-nav-item layui-nav-itemed" style="background-color: #4e5465;"><a href="manager.html">渠道经理管理</a></li>
        <li class="layui-nav-item"><a href="order.html">订单管理</a></li>
		<li class="layui-nav-item"><a href="news.html">动态管理</a></li>
      </ul>
    </div>
  </div>
<!--框架头部-->
<div class="layui-body">
	<div style="padding: 15px;">
      <!-- 内容主体区域 star-->
        <table class="layui-hide" id="test" lay-filter="demo"></table>
        <table class="layui-table">
            <tr>
                <td colspan="2">提成总额</td>
                <td>2016-11-29</td>
            </tr>
        </table>
        <script type="text/html" id="barDemo">
            <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">编辑</a>
            <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">转出</a>
        </script>
        <div id="edit" style="display: none;margin: 10px 20% 10% 20%;">
        <form class="layui-form" action="javascript:;" id="form">
		  <div class="layui-form-item">
			<div class="layui-inline">
			  <label class="layui-form-label">用户名</label>
			  <div class="layui-input-inline">
				<input type="hidden" name="userId" id="userId">
				<input type="text" name="username" class="layui-input" disabled>
			  </div>
			</div>
		  </div>
		  <div class="layui-form-item">
			<label class="layui-form-label">审核状态</label>
			<div class="layui-input-block">
			  <input type="radio" name="applyManagerStatus" value="2" title="已通过" >
			  <input type="radio" name="applyManagerStatus" value="3" title="未通过">
			</div>
		  </div>
		  <div class="layui-form-item">
			<label class="layui-form-label">用户角色</label>
			<div class="layui-input-block">
			  <input type="radio" name="roleManager" value="3" title="线上渠道经理">
			  <input type="radio" name="roleManager" value="4" title="线下渠道经理">
			</div>
		  </div>
		  <div class="layui-form-item">
			<div class="layui-inline">
			  <label class="layui-form-label">提成比例</label>
			  <div class="layui-input-inline" style="width: 100px;">
				<input type="text" name="commissionRate" class="layui-input">
			  </div>
			  <div class="layui-form-mid">%</div>			  
			</div>
		  </div>
          <div class="layui-form-item">
            <div class="layui-input-block">
              <button class="layui-btn" id="sub">立即提交</button>
              <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
          </div>
        </form>
      </div>
        <div id="del" style="display: none;margin:10px 0 0px 10%;">
            <form class="" action="javascript:;" id="form_del">
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">待转出用户</label>
                        <div class="layui-input-inline">
                            <input type="text" name="username" class="layui-input" style="background-color: #c9c9c9;" disabled>
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">待转入用户</label>
                    <input type="hidden" name="from">
                    <div class="layui-inline">
                        <select name="to" id="username" class="layui-input layui-select">

                        </select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button class="layui-btn" id="sub1">立即提交</button>
                    </div>
                </div>
            </form>
        </div>
      <!-- 内容主体区域 end-->
	</div>
</div>
    <
<!--框架底部 star---->

<div class="layui-footer">
<!-- 底部固定区域 -->
© 青脉果酒管理后台 - 底部固定区域
</div>
</div>
<div style="display: none;padding: 15px;" id="password">
		<form class="layui-form" action="javascript:;" id="pass_form">
          <div class="layui-form-item">
            <label class="layui-form-label">旧密码</label>
            <div class="layui-input-block">
              <input type="password" name="passwordOld"  autocomplete="off"  class="layui-input" style="width:70%;">
            </div>
          </div>
		  <div class="layui-form-item">
            <label class="layui-form-label">新密码</label>
            <div class="layui-input-block">
              <input type="password" name="passwordNew" autocomplete="off" class="layui-input" style="width:70%;">
            </div>
          </div>
          <div class="layui-form-item">
            <div class="layui-input-block">
              <button class="layui-btn" id="sub_pass">立即提交</button>
              <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
          </div>
        </form>
	  </div>
<script>
	$("#pass_cs").click(function(){
		layer.open({
			type: 1,
			shade: false,
			title: '重设密码',
			skin: 'yourclass',
			area: ['400px', '260px'], //宽高
			content: $("#password")
		});
	})
	$("#sub_pass").click(function(){
		var url      = "/qingmai/manage/user/reset_password.do";
		$.post(url,$("#pass_form").serialize(),function(result){
			if(result.statues == 0){
				layer.msg("修改成功");
				setTimeout(function(){
					 window.location.href = "login.html";
				},1500)
			}else {
				layer.msg("修改失败");
				setTimeout(function(){
					window.location.reload();
				},1500)
			}
		});
	})
	  //注销
	$("#logout").click(function () {
		var url      = "/qingmai/manage/user/logout.do";
		$.post(url,{},function(result){
			console.log(result);
			if(result.code == 1){
				layer.msg("用户退出");
				setTimeout(function(){
					 window.location.href = "login.html";
				},1500)
			}else {
				layer.msg("用户异常");
				setTimeout(function(){
                    window.location.href = "login.html";
				},1500)
			}
		});
	})
</script>
<script>
  //JavaScript代码区域
  layui.use('element', function(){
    var element = layui.element;

  });
</script>
<!--框架底部 end   footer-->
<script>
  layui.use(['table'], function(){
    var laydate = table = layui.table;
    table.render({
      elem: '#test'
      ,url: '/qingmai/manage/user/select_apply_role.do'//数据接口
      ,page: true //开启分页
	  ,method: 'POST' //方式
      ,cols: [[ //表头
         {field: 'id', title: 'ID', sort: true, fixed: 'left'}
        ,{field: 'nickname', title: '用户名'}
        ,{field: 'haveCode', title: '邀请码', sort: true,templet: function(d){if(d.haveCode){return d.haveCode;}else{return "无";}}}
        ,{field: 'city', title: '城市'}
        ,{field: 'applyManagerStatus', title: '审核状态',templet: function(d){if(d.applyManagerStatus==0){return "未付款";}else if(d.applyManagerStatus==1){return "审核中";}else if(d.applyManagerStatus==2){return "已通过";}else if(d.applyManagerStatus==3){return "未通过";}}}
        ,{field: 'integral', title: '积分', sort: true}
        ,{field: 'commission', title: '提成金额',sort: true}
        ,{field: 'commissionRate', title: '提成比例',sort: true}
        ,{field: 'roleManager', title: '角色',templet: function(d){if(d.roleManager==3){return "线上渠道经理";}else{return "线下渠道经理";}}}
        ,{field: 'createTime', title: '创建时间',sort: true,templet: function(d){return getMyDate(d.createTime);}}
        ,{fixed: 'right', width: 165, align:'center', toolbar: '#barDemo', title: '操作'}
      ]],
        done: function(res, curr, count){
            //如果是异步请求数据方式，res即为你接口返回的信息。
            //如果是直接赋值的方式，res即为：{data: [], count: 99} data为当前页数据、count为数据总长度
            console.log(res);

            //得到当前页码
            console.log(curr);

            //得到数据总量
            console.log(count);
        }
    });
      console.log(table)
	

    //监听工具条
    table.on('tool(demo)', function(obj){ //注：tool是工具条事件名，test是table原始容器的属性 lay-filter="对应的值"
      var data = obj.data //获得当前行数据
              ,layEvent = obj.event; //获得 lay-event 对应的值

      if(layEvent === 'detail'){
		layer.open({
			type: 1,
			shade: false,
			title: false,
			skin: 'yourclass',
			area: ['100%', '100%'], //宽高
			content: $("#edit")
		  });
		    $("input[name='userId']").val(data.id);
			$("input[name='username']").val(data.nickname);
			$('input[name="applyManagerStatus"][value='+data.applyManagerStatus+']').attr("checked",true); 
			$('input[name="applyManagerStatus"][value='+data.applyManagerStatus+']').next("div").addClass("layui-form-radioed");
			$('input[name="applyManagerStatus"][value='+data.applyManagerStatus+']').next("div").find("i").addClass("layui-anim-scaleSpring");
			
			$('input[name="roleManager"][value='+data.roleManager+']').attr("checked",true); 
			$('input[name="roleManager"][value='+data.roleManager+']').next("div").addClass("layui-form-radioed");
			$('input[name="roleManager"][value='+data.roleManager+']').next("div").find("i").addClass("layui-anim-scaleSpring");
			$("input[name='commissionRate']").val(data.commissionRate*100);
		
		
		$("#sub").click(function () {
				var url      = "/qingmai/manage/user/apply_result.do";
				$.post(url,$("#form").serialize(),function(result){
					layer.msg(result.msg);
					setTimeout(function(){
					window.location.reload();
				},1500)
				});
			})	
      } else if(layEvent === 'del'){
          $("input[name='from']").val(data.id);
          layer.open({
              type: 1,
              shade: false,
              title: false,
              skin: 'yourclass',
              area: ['30%', '50%'], //宽高
              content: $("#del")
          });
          var url = '/qingmai/manage/user/select_apply_role.do';
          var ustr="";
          $.post(url,{},function(result){
              console.log(result)
              $.each(result.data, function(n,v) {
                  ustr +='<option  value="'+v.id+'">'+v.nickname+'</option><i class="layui-edge"></i>';
              })
              $("#username").append(ustr);
              $("input[name='username']").val(data.nickname);
              $("#sub1").click(function () {
                  var url      = "/qingmai/manage/user/big_customer_handover.do";
                  $.post(url,$("#form_del").serialize(),function(result){
                      console.log(result)
                      layer.msg(result.msg);
                      setTimeout(function(){
                          window.location.reload();
                      },1500)
                  });
              })
              /*if(result.statues == 0){
                  layer.msg("修改成功");
                  setTimeout(function(){
                      window.location.href = "login.html";
                  },1500)
              }else {
                  layer.msg("修改失败");
              }*/
          });
      } else if(layEvent === 'edit'){
        layer.msg('编辑操作');
      }
    });
  });

    function getMyDate(str){  
		var oDate = new Date(str),  
		oYear = oDate.getFullYear(),  
		oMonth = oDate.getMonth()+1,  
		oDay = oDate.getDate(),  
		oHour = oDate.getHours(),  
		oMin = oDate.getMinutes(),  
		oSen = oDate.getSeconds(),  
		oTime = oYear +'-'+ getzf(oMonth) +'-'+ getzf(oDay) +' '+ getzf(oHour) +':'+ getzf(oMin) +':'+getzf(oSen);//最后拼接时间  
		return oTime;  
	}; 
		//补0操作
	function getzf(num){  
	  if(parseInt(num) < 10){  
		  num = '0'+num;  
	  }  
	  return num;  
	}
</script>

</body>
</html>