<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>青脉果酒管理后台</title>
    <link rel="stylesheet" href="src/css/layui.css">
    <link rel="stylesheet" type="text/css" href="uploder/webuploader.css" />
    <link rel="stylesheet" type="text/css" href="uploder/style.css" />
    <script src="js/jquery-2.0.0.min.js"></script>
    <script src="src/layui.js"></script>
    <script type="text/javascript" src="uploder/webuploader.js"></script>
    <script type="text/javascript" src="uploder/upload.js"></script>
</head>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
    <div class="layui-header">
        <div class="layui-logo">青脉果酒管理后台</div>
        <!-- 头部区域（可配合layui已有的水平导航） -->
        <!--<ul class="layui-nav layui-layout-left">
          <li class="layui-nav-item"><a href="">控制台</a></li>
          <li class="layui-nav-item"><a href="">商品管理</a></li>
          <li class="layui-nav-item"><a href="">用户</a></li>
          <li class="layui-nav-item">
            <a href="javascript:;">其它系统</a>
            <dl class="layui-nav-child">
              <dd><a href="">邮件管理</a></dd>
              <dd><a href="">消息管理</a></dd>
              <dd><a href="">授权管理</a></dd>
            </dl>
          </li>
        </ul>-->
        <ul class="layui-nav layui-layout-right">
            <li class="layui-nav-item">
                <a href="javascript:;">
                    <img src="http://t.cn/RCzsdCq" class="layui-nav-img">
                    管理员
                </a>
                <dl class="layui-nav-child">
                    <dd><a id="pass_cs">重设密码</a></dd>

                    <!-- <dd><a href="">安全设置</a></dd> -->
                </dl>
            </li>
            <li class="layui-nav-item"><a href="javascript:;" id="logout">退了</a></li>
        </ul>
    </div>
    <!--框架头部-->

    <div class="layui-side layui-bg-black">
        <div class="layui-side-scroll">
            <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
            <ul class="layui-nav layui-nav-tree"  lay-filter="test">
                <li class="layui-nav-item layui-nav-itemed" style="background-color: #4e5465;"><a class="" href="goods.html">商品管理</a></li>
                <li class="layui-nav-item"><a href="member.html">用户管理</a></li>
                <li class="layui-nav-item"><a href="manager.html">渠道经理管理</a></li>
                <li class="layui-nav-item"><a href="order.html">订单管理</a></li>
                <li class="layui-nav-item"><a href="news.html">动态管理</a></li>
            </ul>
        </div>
    </div>
    <!--框架头部-->
    <div class="layui-body">
        <div style="margin: 5% 5% 5% 5%;">
    <form class="layui-form" action="javascript:;" id="form">
        <div class="layui-form-item">
            <label class="layui-form-label">商品名称</label>
            <div class="layui-input-block">
                <input type="hidden" name="id" id="goods_id">
                <input type="text" name="name" lay-verify="required|name" autocomplete="off" placeholder="请输入商品名称" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">商品副标题</label>
            <div class="layui-input-block">
                <input type="text" name="subtitle" autocomplete="off" lay-verify="required|subtitle" placeholder="请输入商品副标题" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">商品图片</label>
            <button class="layui-btn test" id="test1">上传文件</button>
            <div class="layui-upload-list">
                <img class="layui-upload-img" id="img_zt">
                <input type="hidden" value=""  name="mainImage" id="url_img">
                <p id="demoText"></p>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">图片相册</label>
            <div class="layui-input-block">
                <input type="hidden" id="images_file" name="img_all" value="">
                <div id="wrapper">
                    <div id="container">
                        <!--头部，相册选择和格式选择-->
                        <div id="uploader">
                            <div class="queueList">
                                <div id="dndArea" class="placeholder">
                                    <div id="filePicker"></div>
                                    <p>或将照片拖到这里，单次最多可选300张</p>
                                </div>
                            </div>
                            <div class="statusBar" style="display:none;">
                                <div class="progress">
                                    <span class="text">0%</span>
                                    <span class="percentage"></span>
                                </div><div class="info"></div>
                                <div class="btns">
                                    <div id="filePicker2"></div><div class="uploadBtn">开始上传</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">价格</label>
                <div class="layui-input-inline" style="width: 100px;">
                    <input type="text" name="price" placeholder="￥" autocomplete="off" lay-verify="required|price" class="layui-input">
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">促销价</label>
                <div class="layui-input-inline" style="width: 100px;">
                    <input type="text" name="disprice" placeholder="￥" autocomplete="off" lay-verify="required|price" class="layui-input">
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">商品类型</label>
            <div class="layui-inline">
                <select name="type" id="type">
                    <option value="1">普通商品</option>
                    <option value="2">大客户商品</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">库存</label>
            <div class="layui-input-block">
                <input type="text" name="stock" id="stock" placeholder="请输入库存" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">商品详情</label>
            <div class="layui-input-block">
                <textarea id="content" style="display: none;" name="detail"></textarea>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn" id="sub">立即提交</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
    </form>
</div>
    </div>
    <div class="layui-footer">
        <!-- 底部固定区域 -->
        © 青脉果酒管理后台 - 底部固定区域
    </div>
</div>
</body>
<script>
    //JavaScript代码区域
    layui.use('element', function(){
        var element = layui.element;

    });
    layui.use(['table'], function(obj) {
        //添加商品
            layui.use('layedit', function () {
                var layedit = layui.layedit;
                layedit.set({
                    uploadImage: {
                        url: '/qingmai/manage/product/uploadForWangText.do' //接口url
                        , type: 'post' //默认post
                        , field: 'imgFile'
                    }
                });
                var index = layedit.build('content', {
                    height: 180 //设置编辑器高度
                });
                $("#sub").click(function () {
                    layedit.sync(index)
                    var name = $("input[name='name']").val();
                    var subtitle = $("input[name='subtitle']").val();
                    var mainImage = $("input[name='mainImage']").val();
                    var subImages = $("input[name='subImages']").val();
                    var price = $("input[name='price']").val();
                    var type = $('#type option:selected').val();
                    var stock = $("#stock").val();

                    if (name == "") {
                        layer.msg('商品名称不能为空');
                        return false;
                    }
                    if (subtitle == "") {
                        layer.msg('商品副标题不能为空');
                        return false;
                    }
                    if (subImages == "") {
                        layer.msg('商品扩展链接不能为空');
                        return false;
                    }
                    if (mainImage == "") {
                        layer.msg('商品主图不能为空');
                        return false;
                    }
                    if (price == "") {
                        layer.msg('商品价格不能为空');
                        return false;
                    }
                    if (type == "") {
                        layer.msg('商品类型不能为空');
                        return false;
                    }
                    if (stock == "") {
                        layer.msg('库存不能为空');
                        return false;
                    }
                    console.log($("#form").serialize());
                    var url = "/qingmai/manage/product/save.do";
                    $.post(url, $("#form").serialize(), function (result) {
                        //console.log(result)
                        if (result) {
                            setTimeout(function () {
                                window.location.reload();
                            }, 1500)
                        }
                    });
                })
            });
            layui.use('upload', function () {
                var $ = layui.jquery
                        , upload = layui.upload;

                //普通图片上传
                var uploadInst = upload.render({
                    elem: '#test1'
                    , url: '/qingmai/manage/product/uploadImage.do'
                    , field: 'imgFile'
                    , before: function (obj) {
                        //预读本地文件示例，不支持ie8
                        //layer.load(); //上传loading
                        //this.data={'xxx':'xxx'};
                        obj.preview(function (index, file, result) {
                            $('#img_zt').attr('src', result); //图片链接（base64）
                        });
                    }
                    , done: function (res) {
                        console.log(res)
                        var img_url = res.data.firstUrl;
                        $("#url_img").val(img_url)
                        //如果上传失败
                        if (res.code > 0) {
                            return layer.msg('上传失败');
                        }
                        //上传成功
                    }
                    , error: function () {
                        //演示失败状态，并实现重传
                        var demoText = $('#demoText');
                        demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-mini demo-reload">重试</a>');
                        demoText.find('.demo-reload').on('click', function () {
                            uploadInst.upload();
                        });
                    }
                });
            });
    })
</script>
</html>